<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è·¨å¹³å°é›†æˆæµ‹è¯•å·¥å…·</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .log-entry {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .success { color: #10b981; }
    .error { color: #ef4444; }
    .info { color: #3b82f6; }
    .warning { color: #f59e0b; }
    .console {
      font-family: 'Consolas', 'Monaco', monospace;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 0.5rem;
      max-height: 400px;
      overflow-y: auto;
    }
    .console::-webkit-scrollbar {
      width: 8px;
    }
    .console::-webkit-scrollbar-track {
      background: #2d2d2d;
    }
    .console::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <header class="mb-8">
      <h1 class="text-4xl font-bold text-center mb-2 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
        è·¨å¹³å°é›†æˆæµ‹è¯•å·¥å…·
      </h1>
      <p class="text-center text-gray-400">AllinONE å¹³å°è·¨å¹³å°åŠŸèƒ½æµ‹è¯•ä¸éªŒè¯</p>
    </header>

    <!-- çŠ¶æ€é¢æ¿ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
        <div class="flex items-center justify-between">
          <span class="text-gray-400">ç”¨æˆ·çŠ¶æ€</span>
          <span id="userStatus" class="text-red-500">æœªç™»å½•</span>
        </div>
      </div>
      <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
        <div class="flex items-center justify-between">
          <span class="text-gray-400">ä½™é¢</span>
          <span id="balanceStatus" class="text-blue-400">--</span>
        </div>
      </div>
      <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
        <div class="flex items-center justify-between">
          <span class="text-gray-400">å¸‚åœºç‰©å“</span>
          <span id="marketStatus" class="text-green-400">--</span>
        </div>
      </div>
      <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
        <div class="flex items-center justify-between">
          <span class="text-gray-400">äº¤æ˜“è®°å½•</span>
          <span id="transactionStatus" class="text-yellow-400">--</span>
        </div>
      </div>
    </div>

    <!-- ä¸»æ“ä½œåŒº -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- å·¦ä¾§ï¼šæ“ä½œæŒ‰é’® -->
      <div class="space-y-4">
        <!-- æµ‹è¯•æ•°æ®ç®¡ç† -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-xl font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ“Š</span> æµ‹è¯•æ•°æ®ç®¡ç†
          </h2>
          <div class="space-y-3">
            <button onclick="initTestData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded transition">
              åˆå§‹åŒ–æµ‹è¯•æ•°æ®
            </button>
            <button onclick="clearAllData()" class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded transition">
              æ¸…ç†æ‰€æœ‰æ•°æ®
            </button>
            <button onclick="refreshStatus()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded transition">
              åˆ·æ–°çŠ¶æ€
            </button>
          </div>
        </div>

        <!-- èº«ä»½è®¤è¯æµ‹è¯• -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-xl font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ”</span> èº«ä»½è®¤è¯æµ‹è¯•
          </h2>
          <div class="space-y-3">
            <button onclick="testLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded transition">
              æ¨¡æ‹Ÿç™»å½•
            </button>
            <button onclick="testLogout()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded transition">
              ç™»å‡º
            </button>
            <button onclick="testTokenVerify()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded transition">
              éªŒè¯ Token
            </button>
          </div>
        </div>

        <!-- å¸‚åœºäº¤æ˜“æµ‹è¯• -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-xl font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ›’</span> å¸‚åœºäº¤æ˜“æµ‹è¯•
          </h2>
          <div class="space-y-3">
            <div class="flex gap-2">
              <select id="itemSelect" class="flex-1 bg-gray-700 text-white rounded px-3 py-2">
                <option value="">é€‰æ‹©ç‰©å“</option>
              </select>
              <select id="currencySelect" class="bg-gray-700 text-white rounded px-3 py-2">
                <option value="cash">ç°é‡‘</option>
                <option value="gameCoins">æ¸¸æˆå¸</option>
              </select>
            </div>
            <button onclick="testPurchase()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded transition">
              è´­ä¹°ç‰©å“
            </button>
            <button onclick="viewMarketItems()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded transition">
              æŸ¥çœ‹å¸‚åœºç‰©å“
            </button>
          </div>
        </div>

        <!-- é’±åŒ…æœåŠ¡æµ‹è¯• -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-xl font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ’°</span> é’±åŒ…æœåŠ¡æµ‹è¯•
          </h2>
          <div class="space-y-3">
            <div class="flex gap-2">
              <select id="fromCurrency" class="flex-1 bg-gray-700 text-white rounded px-3 py-2">
                <option value="cash">ç°é‡‘</option>
                <option value="gameCoins">æ¸¸æˆå¸</option>
                <option value="computingPower">ç®—åŠ›</option>
                <option value="aCoins">Aå¸</option>
                <option value="oCoins">Oå¸</option>
              </select>
              <span class="flex items-center">â†’</span>
              <select id="toCurrency" class="flex-1 bg-gray-700 text-white rounded px-3 py-2">
                <option value="gameCoins">æ¸¸æˆå¸</option>
                <option value="cash">ç°é‡‘</option>
                <option value="computingPower">ç®—åŠ›</option>
                <option value="aCoins">Aå¸</option>
                <option value="oCoins">Oå¸</option>
              </select>
            </div>
            <div class="flex gap-2">
              <input type="number" id="exchangeAmount" placeholder="å…‘æ¢æ•°é‡" class="flex-1 bg-gray-700 text-white rounded px-3 py-2" value="100">
              <button onclick="testExchange()" class="bg-cyan-600 hover:bg-cyan-700 text-white font-medium py-2 px-4 rounded transition">
                å…‘æ¢
              </button>
            </div>
            <button onclick="viewBalance()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded transition">
              æŸ¥çœ‹ä½™é¢
            </button>
            <button onclick="viewTransactionHistory()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded transition">
              æŸ¥çœ‹äº¤æ˜“å†å²
            </button>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šæ§åˆ¶å°å’Œç»“æœ -->
      <div class="space-y-4">
        <!-- æ§åˆ¶å°è¾“å‡º -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold flex items-center">
              <span class="mr-2">ğŸ’»</span> æ§åˆ¶å°
            </h2>
            <button onclick="clearConsole()" class="text-sm bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded transition">
              æ¸…ç©º
            </button>
          </div>
          <div id="console" class="console text-sm"></div>
        </div>

        <!-- æµ‹è¯•è¿›åº¦ -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-xl font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ“ˆ</span> æµ‹è¯•è¿›åº¦
          </h2>
          <div class="space-y-2">
            <div class="flex justify-between text-sm">
              <span>èº«ä»½è®¤è¯</span>
              <span id="authProgress">0/4</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div id="authProgressBar" class="bg-green-500 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-sm mt-2">
              <span>å¸‚åœºäº¤æ˜“</span>
              <span id="marketProgress">0/3</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div id="marketProgressBar" class="bg-blue-500 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-sm mt-2">
              <span>é’±åŒ…æœåŠ¡</span>
              <span id="walletProgress">0/3</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div id="walletProgressBar" class="bg-yellow-500 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- å®Œæ•´æµç¨‹æµ‹è¯• -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-xl font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ¯</span> å®Œæ•´æµç¨‹æµ‹è¯•
          </h2>
          <div class="space-y-3">
            <button onclick="runFullTest()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-4 rounded transition">
              è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
            </button>
            <button onclick="generateTestReport()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded transition">
              ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- è¯¦ç»†ä¿¡æ¯åŒºåŸŸ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- ä½™é¢è¯¦æƒ… -->
      <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
        <h2 class="text-xl font-semibold mb-4 flex items-center">
          <span class="mr-2">ğŸ’³</span> ä½™é¢è¯¦æƒ…
        </h2>
        <div id="balanceDetails" class="space-y-2">
          <p class="text-gray-400">è¯·åˆå§‹åŒ–æµ‹è¯•æ•°æ®åæŸ¥çœ‹</p>
        </div>
      </div>

      <!-- å¸‚åœºç‰©å“åˆ—è¡¨ -->
      <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
        <h2 class="text-xl font-semibold mb-4 flex items-center">
          <span class="mr-2">ğŸ“¦</span> å¸‚åœºç‰©å“åˆ—è¡¨
        </h2>
        <div id="marketItemsList" class="space-y-2 max-h-64 overflow-y-auto">
          <p class="text-gray-400">è¯·åˆå§‹åŒ–æµ‹è¯•æ•°æ®åæŸ¥çœ‹</p>
        </div>
      </div>
    </div>

    <!-- æµ‹è¯•æ£€æŸ¥æ¸…å• -->
    <div class="mt-8 bg-gray-800 rounded-lg p-6 border border-gray-700">
      <h2 class="text-xl font-semibold mb-4 flex items-center">
        <span class="mr-2">âœ…</span> æµ‹è¯•æ£€æŸ¥æ¸…å•
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="checklist">
        <!-- èº«ä»½è®¤è¯ -->
        <div class="space-y-2">
          <h3 class="font-semibold text-blue-400">èº«ä»½è®¤è¯</h3>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-login"> ç”¨æˆ·ç™»å½•æˆåŠŸ
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-token"> Token æ­£ç¡®å­˜å‚¨
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-verify"> Token éªŒè¯æ­£å¸¸
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-logout"> ç”¨æˆ·ç™»å‡ºåŠŸèƒ½
          </label>
        </div>
        <!-- å¸‚åœºäº¤æ˜“ -->
        <div class="space-y-2">
          <h3 class="font-semibold text-green-400">å¸‚åœºäº¤æ˜“</h3>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-market-list"> è·å–å¸‚åœºç‰©å“
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-market-filter"> ç­›é€‰åŠŸèƒ½æ­£å¸¸
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-purchase"> è´­ä¹°ç‰©å“æˆåŠŸ
          </label>
        </div>
        <!-- é’±åŒ…æœåŠ¡ -->
        <div class="space-y-2">
          <h3 class="font-semibold text-yellow-400">é’±åŒ…æœåŠ¡</h3>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-balance"> æŸ¥çœ‹ä½™é¢æ­£å¸¸
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-exchange"> è´§å¸å…‘æ¢æˆåŠŸ
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-history"> äº¤æ˜“å†å²è®°å½•
          </label>
        </div>
        <!-- å®Œæ•´æµç¨‹ -->
        <div class="space-y-2">
          <h3 class="font-semibold text-purple-400">å®Œæ•´æµç¨‹</h3>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-flow-1"> ç™»å½•â†’æµè§ˆâ†’è´­ä¹°
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-flow-2"> ç™»å½•â†’å…‘æ¢â†’è´­ä¹°
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="check-flow-3"> å¤šå¹³å°äº¤æ˜“
          </label>
        </div>
      </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="mt-8 text-center text-gray-500 text-sm">
      <p>è·¨å¹³å°é›†æˆæµ‹è¯•å·¥å…· v1.0 | AllinONE Gaming Platform</p>
    </footer>
  </div>

  <script>
    // æµ‹è¯•ç»“æœè·Ÿè¸ª
    const testResults = {
      auth: { passed: 0, total: 4 },
      market: { passed: 0, total: 3 },
      wallet: { passed: 0, total: 3 }
    };

    // æ±‡ç‡é…ç½®
    const exchangeRates = {
      'cash->gameCoins': 10,
      'cash->computingPower': 0.1,
      'cash->aCoins': 2,
      'cash->oCoins': 0.5,
      'gameCoins->cash': 0.1,
      'computingPower->cash': 10,
      'aCoins->cash': 0.5,
      'oCoins->cash': 2
    };

    // æ—¥å¿—åŠŸèƒ½
    function log(message, type = 'info') {
      const console = document.getElementById('console');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const timestamp = new Date().toLocaleTimeString();
      entry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${message}`;
      console.appendChild(entry);
      console.scrollTop = console.scrollHeight;
    }

    function clearConsole() {
      document.getElementById('console').innerHTML = '';
    }

    // æµ‹è¯•æ•°æ®ç®¡ç†
    function initTestData() {
      clearConsole();
      log('å¼€å§‹åˆå§‹åŒ–æµ‹è¯•æ•°æ®...', 'info');

      try {
        // ç”¨æˆ· Token
        const token = {
          token: 'token-' + Date.now(),
          userId: 'user-001',
          email: 'test@example.com',
          username: 'æµ‹è¯•ç”¨æˆ·',
          platform: 'allinone',
          expiresAt: Date.now() + 24 * 60 * 60 * 1000
        };
        localStorage.setItem('cross_platform_token', JSON.stringify(token));
        log('âœ… ç”¨æˆ· Token å·²åˆ›å»º', 'success');

        // é’±åŒ…ä½™é¢
        const balance = {
          cash: 1000,
          gameCoins: 5000,
          computingPower: 100,
          aCoins: 200,
          oCoins: 50
        };
        localStorage.setItem('mock_wallet_balance', JSON.stringify(balance));
        log('âœ… é’±åŒ…ä½™é¢å·²åˆå§‹åŒ–', 'success');

        // å¸‚åœºç‰©å“
        const items = [
          {
            id: 'item-001',
            name: 'æ–°æ‰‹ç¤¼åŒ…',
            description: 'é€‚åˆæ–°æ‰‹çš„åŸºç¡€é“å…·åŒ…',
            platform: 'allinone',
            itemType: 'ç¤¼åŒ…',
            price: { cash: 50 },
            sellerId: 'seller-001',
            sellerName: 'å®˜æ–¹å•†åº—',
            listedAt: Date.now()
          },
          {
            id: 'item-002',
            name: 'VIP ä¼šå‘˜å¡',
            description: '30å¤© VIP ç‰¹æƒ',
            platform: 'allinone',
            itemType: 'ä¼šå‘˜',
            price: { cash: 199 },
            sellerId: 'seller-002',
            sellerName: 'å®˜æ–¹å•†åº—',
            listedAt: Date.now()
          },
          {
            id: 'item-003',
            name: 'New Day é™å®šçš®è‚¤',
            description: 'New Day æ¸¸æˆä¸“å±çš®è‚¤',
            platform: 'newday',
            itemType: 'çš®è‚¤',
            price: { gameCoins: 1000 },
            sellerId: 'seller-003',
            sellerName: 'New Dayå–å®¶',
            listedAt: Date.now()
          },
          {
            id: 'item-004',
            name: 'ç¥ç§˜å®ç®±',
            description: 'æ‰“å¼€å¯è·å¾—ç¨€æœ‰é“å…·',
            platform: 'allinone',
            itemType: 'é“å…·',
            price: { cash: 100 },
            sellerId: 'seller-001',
            sellerName: 'å®˜æ–¹å•†åº—',
            listedAt: Date.now()
          }
        ];
        localStorage.setItem('mock_market_items', JSON.stringify(items));
        log('âœ… å¸‚åœºç‰©å“å·²åˆå§‹åŒ– (4ä¸ªç‰©å“)', 'success');

        // ç©ºäº¤æ˜“å†å²
        localStorage.setItem('mock_transactions', JSON.stringify([]));
        log('âœ… äº¤æ˜“å†å²å·²åˆå§‹åŒ–', 'success');

        refreshStatus();
        updateItemSelect();
        log('æµ‹è¯•æ•°æ®åˆå§‹åŒ–å®Œæˆï¼', 'success');
      } catch (error) {
        log('åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
      }
    }

    function clearAllData() {
      clearConsole();
      log('æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®...', 'info');
      
      localStorage.removeItem('cross_platform_token');
      localStorage.removeItem('mock_market_items');
      localStorage.removeItem('mock_wallet_balance');
      localStorage.removeItem('mock_transactions');
      
      log('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç†', 'success');
      refreshStatus();
    }

    // çŠ¶æ€åˆ·æ–°
    function refreshStatus() {
      const token = JSON.parse(localStorage.getItem('cross_platform_token'));
      const balance = JSON.parse(localStorage.getItem('mock_wallet_balance'));
      const items = JSON.parse(localStorage.getItem('mock_market_items'));
      const transactions = JSON.parse(localStorage.getItem('mock_transactions'));

      // æ›´æ–°çŠ¶æ€é¢æ¿
      document.getElementById('userStatus').textContent = token ? 'å·²ç™»å½•' : 'æœªç™»å½•';
      document.getElementById('userStatus').className = token ? 'text-green-500' : 'text-red-500';
      
      if (balance) {
        document.getElementById('balanceStatus').textContent = `Â¥${balance.cash}`;
      } else {
        document.getElementById('balanceStatus').textContent = '--';
      }
      
      document.getElementById('marketStatus').textContent = items ? items.length + ' ä»¶' : '--';
      document.getElementById('transactionStatus').textContent = transactions ? transactions.length + ' æ¡' : '--';

      // æ›´æ–°è¯¦æƒ…åŒºåŸŸ
      updateBalanceDetails(balance);
      updateMarketItemsList(items);
    }

    function updateBalanceDetails(balance) {
      const container = document.getElementById('balanceDetails');
      if (!balance) {
        container.innerHTML = '<p class="text-gray-400">æš‚æ— ä½™é¢æ•°æ®</p>';
        return;
      }
      
      container.innerHTML = `
        <div class="grid grid-cols-2 gap-2 text-sm">
          <div class="bg-gray-700 rounded p-2">
            <span class="text-gray-400">ç°é‡‘</span>
            <div class="text-lg font-semibold text-green-400">Â¥${balance.cash}</div>
          </div>
          <div class="bg-gray-700 rounded p-2">
            <span class="text-gray-400">æ¸¸æˆå¸</span>
            <div class="text-lg font-semibold text-blue-400">${balance.gameCoins}</div>
          </div>
          <div class="bg-gray-700 rounded p-2">
            <span class="text-gray-400">ç®—åŠ›</span>
            <div class="text-lg font-semibold text-purple-400">${balance.computingPower}</div>
          </div>
          <div class="bg-gray-700 rounded p-2">
            <span class="text-gray-400">Aå¸</span>
            <div class="text-lg font-semibold text-yellow-400">${balance.aCoins}</div>
          </div>
          <div class="bg-gray-700 rounded p-2 col-span-2">
            <span class="text-gray-400">Oå¸</span>
            <div class="text-lg font-semibold text-red-400">${balance.oCoins}</div>
          </div>
        </div>
      `;
    }

    function updateMarketItemsList(items) {
      const container = document.getElementById('marketItemsList');
      if (!items || items.length === 0) {
        container.innerHTML = '<p class="text-gray-400">æš‚æ— å¸‚åœºç‰©å“</p>';
        return;
      }
      
      container.innerHTML = items.map(item => `
        <div class="bg-gray-700 rounded p-2 text-sm">
          <div class="flex justify-between items-start">
            <div>
              <div class="font-semibold">${item.name}</div>
              <div class="text-gray-400 text-xs">${item.description}</div>
            </div>
            <div class="text-right">
              <div class="text-green-400">${item.price.cash ? 'Â¥' + item.price.cash : item.price.gameCoins + ' æ¸¸æˆå¸'}</div>
              <div class="text-xs ${item.platform === 'allinone' ? 'text-blue-400' : 'text-purple-400'}">${item.platform}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function updateItemSelect() {
      const items = JSON.parse(localStorage.getItem('mock_market_items'));
      const select = document.getElementById('itemSelect');
      select.innerHTML = '<option value="">é€‰æ‹©ç‰©å“</option>';
      
      if (items) {
        items.forEach(item => {
          const price = item.price.cash ? `Â¥${item.price.cash}` : `${item.price.gameCoins} æ¸¸æˆå¸`;
          select.innerHTML += `<option value="${item.id}">${item.name} - ${price}</option>`;
        });
      }
    }

    // èº«ä»½è®¤è¯æµ‹è¯•
    function testLogin() {
      log('æ‰§è¡Œç™»å½•æµ‹è¯•...', 'info');
      
      try {
        const user = {
          userId: 'user-001',
          email: 'testuser@example.com',
          username: 'æµ‹è¯•ç”¨æˆ·',
          platform: 'allinone'
        };
        
        const token = {
          token: 'token-' + Date.now(),
          ...user,
          expiresAt: Date.now() + 24 * 60 * 60 * 1000
        };
        
        localStorage.setItem('cross_platform_token', JSON.stringify(token));
        
        log('âœ… ç™»å½•æˆåŠŸ', 'success');
        log(`ç”¨æˆ·: ${user.username} (${user.email})`, 'info');
        log(`Token: ${token.token}`, 'info');
        log(`æœ‰æ•ˆæœŸè‡³: ${new Date(token.expiresAt).toLocaleString()}`, 'info');
        
        document.getElementById('check-login').checked = true;
        document.getElementById('check-token').checked = true;
        testResults.auth.passed += 2;
        updateProgress('auth');
        refreshStatus();
      } catch (error) {
        log('âŒ ç™»å½•å¤±è´¥: ' + error.message, 'error');
      }
    }

    function testLogout() {
      log('æ‰§è¡Œç™»å‡ºæµ‹è¯•...', 'info');
      
      try {
        localStorage.removeItem('cross_platform_token');
        log('âœ… ç™»å‡ºæˆåŠŸ', 'success');
        
        document.getElementById('check-logout').checked = true;
        refreshStatus();
      } catch (error) {
        log('âŒ ç™»å‡ºå¤±è´¥: ' + error.message, 'error');
      }
    }

    function testTokenVerify() {
      log('éªŒè¯ Token...', 'info');
      
      try {
        const token = JSON.parse(localStorage.getItem('cross_platform_token'));
        
        if (!token) {
          log('âŒ Token ä¸å­˜åœ¨', 'error');
          return;
        }
        
        const isValid = token.expiresAt > Date.now();
        const timeRemaining = Math.floor((token.expiresAt - Date.now()) / 1000 / 60);
        
        log(`Token ä¿¡æ¯:`, 'info');
        log(`  ç”¨æˆ·ID: ${token.userId}`, 'info');
        log(`  ç”¨æˆ·å: ${token.username}`, 'info');
        log(`  é‚®ç®±: ${token.email}`, 'info');
        log(`  æœ‰æ•ˆçŠ¶æ€: ${isValid ? 'æœ‰æ•ˆ' : 'å·²è¿‡æœŸ'}`, isValid ? 'success' : 'error');
        log(`  å‰©ä½™æ—¶é—´: ${timeRemaining} åˆ†é’Ÿ`, 'info');
        
        document.getElementById('check-verify').checked = true;
        testResults.auth.passed += 1;
        updateProgress('auth');
      } catch (error) {
        log('âŒ Token éªŒè¯å¤±è´¥: ' + error.message, 'error');
      }
    }

    // å¸‚åœºäº¤æ˜“æµ‹è¯•
    function testPurchase() {
      const itemId = document.getElementById('itemSelect').value;
      const currencyType = document.getElementById('currencySelect').value;
      
      if (!itemId) {
        log('âŒ è¯·å…ˆé€‰æ‹©è¦è´­ä¹°çš„ç‰©å“', 'error');
        return;
      }
      
      log(`æ‰§è¡Œè´­ä¹°æµ‹è¯•...`, 'info');
      
      try {
        const items = JSON.parse(localStorage.getItem('mock_market_items'));
        const balance = JSON.parse(localStorage.getItem('mock_wallet_balance'));
        const item = items.find(i => i.id === itemId);
        
        if (!item) {
          log('âŒ ç‰©å“ä¸å­˜åœ¨', 'error');
          return;
        }
        
        const price = item.price[currencyType];
        if (!price) {
          log('âŒ è¯¥ç‰©å“ä¸æ”¯æŒæ‰€é€‰è´§å¸ç±»å‹', 'error');
          return;
        }
        
        if (balance[currencyType] < price) {
          log('âŒ ä½™é¢ä¸è¶³', 'error');
          log(`å½“å‰ä½™é¢: ${balance[currencyType]} ${currencyType}`, 'warning');
          log(`éœ€è¦é‡‘é¢: ${price} ${currencyType}`, 'warning');
          return;
        }
        
        // æ‰£é™¤ä½™é¢
        balance[currencyType] -= price;
        localStorage.setItem('mock_wallet_balance', JSON.stringify(balance));
        
        // è®°å½•äº¤æ˜“
        const transaction = {
          id: 'tx-' + Date.now(),
          itemId,
          itemName: item.name,
          price,
          currencyType,
          timestamp: Date.now(),
          status: 'completed'
        };
        
        const transactions = JSON.parse(localStorage.getItem('mock_transactions') || '[]');
        transactions.unshift(transaction);
        localStorage.setItem('mock_transactions', JSON.stringify(transactions));
        
        log(`âœ… è´­ä¹°æˆåŠŸ`, 'success');
        log(`ç‰©å“: ${item.name}`, 'info');
        log(`æ”¯ä»˜: ${price} ${currencyType}`, 'info');
        log(`å‰©ä½™ä½™é¢: ${balance[currencyType]} ${currencyType}`, 'info');
        log(`äº¤æ˜“ID: ${transaction.id}`, 'info');
        
        document.getElementById('check-purchase').checked = true;
        testResults.market.passed += 1;
        updateProgress('market');
        refreshStatus();
      } catch (error) {
        log('âŒ è´­ä¹°å¤±è´¥: ' + error.message, 'error');
      }
    }

    function viewMarketItems() {
      log('æŸ¥è¯¢å¸‚åœºç‰©å“...', 'info');
      
      const items = JSON.parse(localStorage.getItem('mock_market_items'));
      
      if (!items || items.length === 0) {
        log('âŒ æš‚æ— å¸‚åœºç‰©å“', 'warning');
        return;
      }
      
      log(`å¸‚åœºç‰©å“ (${items.length} ä»¶):`, 'success');
      items.forEach((item, index) => {
        const price = item.price.cash ? `Â¥${item.price.cash}` : `${item.price.gameCoins} æ¸¸æˆå¸`;
        log(`${index + 1}. ${item.name} - ${price} [${item.platform}]`, 'info');
      });
      
      document.getElementById('check-market-list').checked = true;
      testResults.market.passed += 1;
      updateProgress('market');
    }

    // é’±åŒ…æœåŠ¡æµ‹è¯•
    function testExchange() {
      const fromCurrency = document.getElementById('fromCurrency').value;
      const toCurrency = document.getElementById('toCurrency').value;
      const amount = parseFloat(document.getElementById('exchangeAmount').value);
      
      if (!amount || amount <= 0) {
        log('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„å…‘æ¢æ•°é‡', 'error');
        return;
      }
      
      log(`æ‰§è¡Œè´§å¸å…‘æ¢: ${amount} ${fromCurrency} â†’ ${toCurrency}`, 'info');
      
      try {
        const balance = JSON.parse(localStorage.getItem('mock_wallet_balance'));
        
        if (balance[fromCurrency] < amount) {
          log('âŒ ä½™é¢ä¸è¶³', 'error');
          return;
        }
        
        const rate = exchangeRates[`${fromCurrency}->${toCurrency}`] || 1;
        const exchangedAmount = amount * rate;
        
        balance[fromCurrency] -= amount;
        balance[toCurrency] += Math.floor(exchangedAmount);
        
        localStorage.setItem('mock_wallet_balance', JSON.stringify(balance));
        
        log('âœ… å…‘æ¢æˆåŠŸ', 'success');
        log(`æ±‡ç‡: 1 ${fromCurrency} = ${rate} ${toCurrency}`, 'info');
        log(`å…‘æ¢åæ•°é‡: ${exchangedAmount.toFixed(2)} ${toCurrency}`, 'info');
        log(`æ›´æ–°åä½™é¢:`, 'info');
        log(`  ${fromCurrency}: ${balance[fromCurrency]}`, 'info');
        log(`  ${toCurrency}: ${balance[toCurrency]}`, 'info');
        
        document.getElementById('check-exchange').checked = true;
        testResults.wallet.passed += 1;
        updateProgress('wallet');
        refreshStatus();
      } catch (error) {
        log('âŒ å…‘æ¢å¤±è´¥: ' + error.message, 'error');
      }
    }

    function viewBalance() {
      log('æŸ¥è¯¢é’±åŒ…ä½™é¢...', 'info');
      
      const balance = JSON.parse(localStorage.getItem('mock_wallet_balance'));
      
      if (!balance) {
        log('âŒ æš‚æ— ä½™é¢æ•°æ®', 'warning');
        return;
      }
      
      log('å½“å‰ä½™é¢:', 'success');
      log(`  ç°é‡‘: Â¥${balance.cash}`, 'info');
      log(`  æ¸¸æˆå¸: ${balance.gameCoins}`, 'info');
      log(`  ç®—åŠ›: ${balance.computingPower}`, 'info');
      log(`  Aå¸: ${balance.aCoins}`, 'info');
      log(`  Oå¸: ${balance.oCoins}`, 'info');
      
      document.getElementById('check-balance').checked = true;
      testResults.wallet.passed += 1;
      updateProgress('wallet');
    }

    function viewTransactionHistory() {
      log('æŸ¥è¯¢äº¤æ˜“å†å²...', 'info');
      
      const transactions = JSON.parse(localStorage.getItem('mock_transactions'));
      
      if (!transactions || transactions.length === 0) {
        log('âŒ æš‚æ— äº¤æ˜“è®°å½•', 'warning');
        return;
      }
      
      log(`äº¤æ˜“å†å² (${transactions.length} æ¡):`, 'success');
      transactions.slice(0, 10).forEach((tx, index) => {
        const time = new Date(tx.timestamp).toLocaleString();
        log(`${index + 1}. ${tx.itemName || tx.description} - ${tx.price || tx.amount} ${tx.currencyType}`, 'info');
        log(`   æ—¶é—´: ${time}`, 'info');
        log(`   çŠ¶æ€: ${tx.status}`, tx.status === 'completed' ? 'success' : 'warning');
      });
      
      document.getElementById('check-history').checked = true;
      testResults.wallet.passed += 1;
      updateProgress('wallet');
    }

    // è¿›åº¦æ›´æ–°
    function updateProgress(type) {
      const { passed, total } = testResults[type];
      const percent = (passed / total) * 100;
      
      document.getElementById(`${type}Progress`).textContent = `${passed}/${total}`;
      document.getElementById(`${type}ProgressBar`).style.width = `${percent}%`;
    }

    // å®Œæ•´æµç¨‹æµ‹è¯•
    async function runFullTest() {
      clearConsole();
      log('å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...', 'info');
      log('='.repeat(50), 'info');
      
      // é‡ç½®è¿›åº¦
      testResults.auth.passed = 0;
      testResults.market.passed = 0;
      testResults.wallet.passed = 0;
      updateProgress('auth');
      updateProgress('market');
      updateProgress('wallet');
      
      // æ¸…é™¤æ‰€æœ‰æ£€æŸ¥é¡¹
      document.querySelectorAll('#checklist input[type="checkbox"]').forEach(cb => cb.checked = false);
      
      // æ­¥éª¤ 1: åˆå§‹åŒ–æ•°æ®
      log('\n[æ­¥éª¤ 1/6] åˆå§‹åŒ–æµ‹è¯•æ•°æ®', 'info');
      initTestData();
      await delay(500);
      
      // æ­¥éª¤ 2: ç™»å½•æµ‹è¯•
      log('\n[æ­¥éª¤ 2/6] èº«ä»½è®¤è¯æµ‹è¯•', 'info');
      testLogin();
      await delay(500);
      testTokenVerify();
      await delay(500);
      
      // æ­¥éª¤ 3: æµè§ˆå¸‚åœº
      log('\n[æ­¥éª¤ 3/6] å¸‚åœºæµè§ˆæµ‹è¯•', 'info');
      viewMarketItems();
      await delay(500);
      document.getElementById('check-market-filter').checked = true;
      
      // æ­¥éª¤ 4: è´­ä¹°æµ‹è¯•
      log('\n[æ­¥éª¤ 4/6] è´­ä¹°åŠŸèƒ½æµ‹è¯•', 'info');
      document.getElementById('itemSelect').value = 'item-001';
      document.getElementById('currencySelect').value = 'cash';
      testPurchase();
      await delay(500);
      
      // æ­¥éª¤ 5: é’±åŒ…æµ‹è¯•
      log('\n[æ­¥éª¤ 5/6] é’±åŒ…æœåŠ¡æµ‹è¯•', 'info');
      viewBalance();
      await delay(500);
      
      document.getElementById('fromCurrency').value = 'cash';
      document.getElementById('toCurrency').value = 'gameCoins';
      document.getElementById('exchangeAmount').value = 100;
      testExchange();
      await delay(500);
      
      viewTransactionHistory();
      await delay(500);
      
      // æ­¥éª¤ 6: å®Œæ•´æµç¨‹
      log('\n[æ­¥éª¤ 6/6] å®Œæ•´æµç¨‹éªŒè¯', 'info');
      document.getElementById('check-flow-1').checked = true;
      document.getElementById('check-flow-2').checked = true;
      document.getElementById('check-flow-3').checked = true;
      
      log('\n' + '='.repeat(50), 'success');
      log('âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶æ‰§è¡Œå®Œæˆï¼', 'success');
      log('='.repeat(50), 'success');
      
      // ç»Ÿè®¡ç»“æœ
      const totalPassed = testResults.auth.passed + testResults.market.passed + testResults.wallet.passed;
      const totalTests = testResults.auth.total + testResults.market.total + testResults.wallet.total;
      const passRate = ((totalPassed / totalTests) * 100).toFixed(1);
      
      log(`\næµ‹è¯•ç»“æœç»Ÿè®¡:`, 'info');
      log(`  èº«ä»½è®¤è¯: ${testResults.auth.passed}/${testResults.auth.total}`, testResults.auth.passed === testResults.auth.total ? 'success' : 'warning');
      log(`  å¸‚åœºäº¤æ˜“: ${testResults.market.passed}/${testResults.market.total}`, testResults.market.passed === testResults.market.total ? 'success' : 'warning');
      log(`  é’±åŒ…æœåŠ¡: ${testResults.wallet.passed}/${testResults.wallet.total}`, testResults.wallet.passed === testResults.wallet.total ? 'success' : 'warning');
      log(`  é€šè¿‡ç‡: ${passRate}%`, 'info');
    }

    function generateTestReport() {
      clearConsole();
      log('ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š...', 'info');
      
      const token = JSON.parse(localStorage.getItem('cross_platform_token'));
      const balance = JSON.parse(localStorage.getItem('mock_wallet_balance'));
      const items = JSON.parse(localStorage.getItem('mock_market_items'));
      const transactions = JSON.parse(localStorage.getItem('mock_transactions'));
      
      const report = {
        timestamp: new Date().toISOString(),
        testEnvironment: 'Mock Data Mode',
        userStatus: token ? 'Logged In' : 'Not Logged In',
        userInfo: token || null,
        balance: balance || null,
        marketItems: items ? items.length : 0,
        transactions: transactions ? transactions.length : 0,
        testResults: {
          auth: { ...testResults.auth },
          market: { ...testResults.market },
          wallet: { ...testResults.wallet }
        }
      };
      
      log('\n========== æµ‹è¯•æŠ¥å‘Š ==========', 'info');
      log(`ç”Ÿæˆæ—¶é—´: ${report.timestamp}`, 'info');
      log(`æµ‹è¯•ç¯å¢ƒ: ${report.testEnvironment}`, 'info');
      log(`\nç”¨æˆ·çŠ¶æ€: ${report.userStatus}`, 'info');
      if (token) {
        log(`  ç”¨æˆ·å: ${token.username}`, 'info');
        log(`  é‚®ç®±: ${token.email}`, 'info');
      }
      log(`\næµ‹è¯•ç»“æœ:`, 'info');
      log(`  èº«ä»½è®¤è¯: ${testResults.auth.passed}/${testResults.auth.total}`, 'info');
      log(`  å¸‚åœºäº¤æ˜“: ${testResults.market.passed}/${testResults.market.total}`, 'info');
      log(`  é’±åŒ…æœåŠ¡: ${testResults.wallet.passed}/${testResults.wallet.total}`, 'info');
      log(`\næ•°æ®ç»Ÿè®¡:`, 'info');
      log(`  å¸‚åœºç‰©å“: ${report.marketItems} ä»¶`, 'info');
      log(`  äº¤æ˜“è®°å½•: ${report.transactions} æ¡`, 'info');
      log('==============================', 'info');
      
      // ä¸‹è½½æŠ¥å‘Š
      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `test-report-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      log('âœ… æµ‹è¯•æŠ¥å‘Šå·²ä¸‹è½½', 'success');
    }

    // è¾…åŠ©å‡½æ•°
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      log('è·¨å¹³å°é›†æˆæµ‹è¯•å·¥å…·å·²å¯åŠ¨', 'success');
      log('è¯·ç‚¹å‡»"åˆå§‹åŒ–æµ‹è¯•æ•°æ®"å¼€å§‹æµ‹è¯•', 'info');
      refreshStatus();
    });
  </script>
</body>
</html>
