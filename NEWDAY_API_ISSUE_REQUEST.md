# New Day API 数据同步问题 - 需求文档

## 问题描述

AllinONE 平台通过 API 从 New Day 获取用户钱包余额时，发现返回的数据与实际 New Day 平台数据不一致。

## 具体现象

1. **New Day 平台实际数据**：
   - 用户初始 `newDayGameCoins`: 100
   - 经过交易后余额已减少（具体数值以 New Day 平台显示为准）

2. **AllinONE 通过 API 获取到的数据**：
   - `newDayGameCoins`: 始终返回 100（不随实际交易变化）
   - 其他字段如 `gameCoins: 1000`, `computingPower: 100`, `aCoins: 50` 也保持不变

3. **API 响应示例**：
```json
{
  "balance": {
    "cash": 0,
    "gameCoins": 1000,
    "computingPower": 100,
    "newDayGameCoins": 100,  // ← 此数值不随实际交易变化
    "aCoins": 50
  },
  "success": true
}
```

## 请求接口信息

- **接口地址**: `https://yxp6y2qgnh.coze.site/api/allinone/wallet/balance`
- **请求方式**: GET
- **认证方式**: Bearer Token
- **Token 示例**: `nd_token_1770079912988_ue40t22...`

## 可能的原因分析

请 New Day 团队检查以下方面：

### 1. 数据缓存问题
- API 是否对余额数据进行了缓存？
- 缓存策略是什么？缓存时间多长？
- 交易发生后是否及时清除了缓存？

### 2. 用户身份识别问题
- API 返回的数据是否对应正确的用户？
- Token 解析后的用户 ID 是否正确？
- 是否存在测试账号/默认数据的硬编码？

### 3. 数据存储问题
- API 读取的是否是生产环境数据库？
- 是否存在读写分离导致的数据延迟？
- 交易数据是否正确写入了数据库？

### 4. 静态数据问题
- API 是否返回了静态/硬编码的测试数据？
- 是否有环境配置错误导致连接到了测试数据库？

## 需求清单

请 New Day 团队提供以下支持：

### 必需项
1. **确认 API 返回的是实时数据而非缓存/静态数据**
2. **提供余额变更后 API 数据更新的机制说明**
3. **检查并修复 `/wallet/balance` 接口的数据准确性**

### 建议项
4. **提供 API 文档**，包括：
   - 完整的请求/响应格式
   - 错误码定义
   - 数据更新频率说明
5. **提供测试环境**，方便联调验证
6. **添加数据一致性校验机制**，如：
   - 返回数据的最后更新时间戳
   - 数据版本号或校验和

## 验证步骤

修复后，请按以下步骤验证：

1. 在 New Day 平台查看用户当前余额（记录数值 A）
2. 在 New Day 平台进行一次交易（如消费 10 个游戏币）
3. 再次查看 New Day 平台余额（记录数值 B = A - 10）
4. 调用 API `/wallet/balance` 获取余额（记录数值 C）
5. 确认 C 等于 B，而非 A

## 联系方式

- **AllinONE 技术负责人**: [填写你的联系方式]
- **期望修复时间**: [填写你的期望时间]
- **紧急程度**: 高（影响用户跨平台数据同步）

---

**附件**：
1. 控制台日志截图（显示 API 返回的静态数据）
2. AllinONE 同步逻辑代码片段（证明我方实现正确）
