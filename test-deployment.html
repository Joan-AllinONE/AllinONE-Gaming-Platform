<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éƒ¨ç½²éªŒè¯ - AllinONE</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #667eea;
      margin-bottom: 20px;
      text-align: center;
    }
    .status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }
    .test-section {
      margin: 30px 0;
    }
    button {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    .btn-secondary:hover {
      background: #5a6268;
    }
    .log {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #667eea;
      padding-left: 10px;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
    }
    .badge-api {
      background: #e3f2fd;
      color: #1976d2;
    }
    .badge-db {
      background: #f3e5f5;
      color: #7b1fa2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ AllinONE éƒ¨ç½²éªŒè¯</h1>

    <div class="status success">
      <span>âœ…</span>
      <span>æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ</span>
    </div>

    <div class="status success">
      <span>âœ…</span>
      <span>å‰ç«¯æ„å»ºå®Œæˆ</span>
    </div>

    <div class="status pending" id="serverStatus">
      <span>â³</span>
      <span>ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨...</span>
    </div>

    <div class="test-section">
      <h3>API æµ‹è¯•</h3>
      <button class="btn-primary" onclick="testHealthCheck()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
      <button class="btn-primary" onclick="testDatabaseConnection()">æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
      <button class="btn-primary" onclick="testInventoryAPI()">æµ‹è¯•åº“å­˜ API</button>
    </div>

    <div class="test-section">
      <h3>å¿«é€Ÿè®¿é—®</h3>
      <button class="btn-primary" onclick="window.open('http://localhost:3000', '_blank')">æ‰“å¼€åº”ç”¨ (http://localhost:3000)</button>
      <button class="btn-secondary" onclick="openDevTools()">æ‰“å¼€å¼€å‘è€…å·¥å…·</button>
    </div>

    <div class="log" id="logContainer">
      <div class="log-entry">ğŸ“‹ ç­‰å¾…æµ‹è¯•...</div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3000/api';

    function log(message, type = 'info') {
      const container = document.getElementById('logContainer');
      const entry = document.createElement('div');
      entry.className = 'log-entry';

      const timestamp = new Date().toLocaleTimeString();
      let badge = '';
      if (type === 'api') {
        badge = '<span class="badge badge-api">API</span>';
      } else if (type === 'db') {
        badge = '<span class="badge badge-db">DB</span>';
      }

      entry.innerHTML = `<small>[${timestamp}]</small> ${badge}${message}`;
      container.appendChild(entry);
      container.scrollTop = container.scrollHeight;
    }

    function updateServerStatus(status) {
      const el = document.getElementById('serverStatus');
      if (status === 'success') {
        el.className = 'status success';
        el.innerHTML = '<span>âœ…</span><span>æœåŠ¡å™¨è¿è¡Œä¸­</span>';
      } else if (status === 'error') {
        el.className = 'status error';
        el.innerHTML = '<span>âŒ</span><span>æœåŠ¡å™¨æœªå¯åŠ¨</span>';
      }
    }

    async function testHealthCheck() {
      log('æ­£åœ¨æµ‹è¯•å¥åº·æ£€æŸ¥...', 'api');
      try {
        const response = await fetch(`${API_BASE}/health`);
        const data = await response.json();
        log(`âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'api');
        updateServerStatus('success');
      } catch (error) {
        log(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, 'api');
        updateServerStatus('error');
      }
    }

    async function testDatabaseConnection() {
      log('æ­£åœ¨æµ‹è¯•æ•°æ®åº“è¿æ¥...', 'db');
      try {
        const response = await fetch(`${API_BASE}/health`);
        const data = await response.json();
        if (data.database === 'connected') {
          log(`âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ: ${data.timestamp}`, 'db');
        } else {
          log(`âš ï¸ æ•°æ®åº“çŠ¶æ€æœªçŸ¥: ${data.database}`, 'db');
        }
      } catch (error) {
        log(`âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: ${error.message}`, 'db');
      }
    }

    async function testInventoryAPI() {
      log('æ­£åœ¨æµ‹è¯•åº“å­˜ API...', 'api');
      try {
        // ä½¿ç”¨æ¨¡æ‹Ÿ token è¿›è¡Œæµ‹è¯•
        const token = 'Bearer test-user-001';
        const response = await fetch(`${API_BASE}/inventory`, {
          headers: {
            'Authorization': token
          }
        });

        if (response.ok) {
          const data = await response.json();
          log(`âœ… åº“å­˜ API æˆåŠŸ: ${data.message}`, 'api');
          log(`ğŸ“¦ åº“å­˜æ•°é‡: ${data.data.pagination.total} ä¸ªé“å…·`, 'api');
        } else {
          log(`âš ï¸ åº“å­˜ API è¿”å› ${response.status} (å¯èƒ½éœ€è¦ç™»å½•)`, 'api');
        }
      } catch (error) {
        log(`âŒ åº“å­˜ API å¤±è´¥: ${error.message}`, 'api');
      }
    }

    function openDevTools() {
      // åœ¨æ–°çª—å£ä¸­æ‰“å¼€å¼€å‘è€…å·¥å…·æç¤º
      log('ğŸ’¡ æç¤º: æŒ‰ F12 æˆ–å³é”®ç‚¹å‡»é¡µé¢é€‰æ‹©"æ£€æŸ¥"æ‰“å¼€å¼€å‘è€…å·¥å…·');
      alert('æŒ‰ F12 æˆ–å³é”®ç‚¹å‡»é¡µé¢é€‰æ‹©"æ£€æŸ¥"æ‰“å¼€å¼€å‘è€…å·¥å…·');
    }

    // è‡ªåŠ¨è¿è¡Œå¥åº·æ£€æŸ¥
    setTimeout(() => {
      testHealthCheck();
    }, 2000);
  </script>
</body>
</html>
