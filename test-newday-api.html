<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Day API æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #eee;
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      color: #00d4ff;
      margin-bottom: 20px;
      text-align: center;
    }
    .section {
      background: #16213e;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #0f3460;
    }
    h2 {
      color: #e94560;
      margin-bottom: 15px;
      font-size: 18px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #aaa;
      font-size: 14px;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      background: #0f3460;
      border: 1px solid #1a1a2e;
      border-radius: 5px;
      color: #fff;
      font-size: 14px;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #00d4ff;
    }
    textarea {
      min-height: 150px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    button {
      background: #e94560;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    button:hover {
      background: #ff6b6b;
    }
    button:disabled {
      background: #666;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #0f3460;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 400px;
      overflow-y: auto;
    }
    .success {
      border-left: 4px solid #00d4ff;
    }
    .error {
      border-left: 4px solid #e94560;
    }
    .preset-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    .preset-btn {
      background: #0f3460;
      padding: 8px 16px;
      font-size: 14px;
    }
    .preset-btn:hover {
      background: #1a4a7a;
    }
    .info-box {
      background: #1a4a7a;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ® New Day API æµ‹è¯•å·¥å…·</h1>
    
    <div class="section">
      <h2>é…ç½®</h2>
      <div class="form-group">
        <label>API åŸºç¡€åœ°å€</label>
        <input type="text" id="apiBase" value="http://localhost:3001/api" placeholder="http://localhost:3001/api">
      </div>
      <div class="form-group">
        <label>è®¤è¯ Tokenï¼ˆä» localStorage è·å– newday_tokenï¼‰</label>
        <input type="text" id="authToken" placeholder="è¾“å…¥ New Day Token">
      </div>
      <button onclick="getTokenFromStorage()">ä» LocalStorage è·å– Token</button>
    </div>

    <div class="section">
      <h2>è¯·æ±‚æ•°æ®</h2>
      <div class="info-box">
        ç‚¹å‡»é¢„è®¾æŒ‰é’®å¿«é€Ÿå¡«å……æ•°æ®ï¼Œæˆ–æ‰‹åŠ¨ç¼–è¾‘ JSON
      </div>
      <div class="preset-buttons">
        <button class="preset-btn" onclick="loadPreset('health')">ç”Ÿå‘½è¯æ°´</button>
        <button class="preset-btn" onclick="loadPreset('sword')">æ­¦å™¨</button>
        <button class="preset-btn" onclick="loadPreset('armor')">æŠ¤ç”²</button>
        <button class="preset-btn" onclick="loadPreset('minimal')">æœ€å°æ•°æ®</button>
      </div>
      <div class="form-group">
        <label>è¯·æ±‚ JSON</label>
        <textarea id="requestBody" placeholder="{
  &quot;itemId&quot;: &quot;test_item_001&quot;,
  &quot;name&quot;: &quot;æµ‹è¯•é“å…·&quot;,
  &quot;type&quot;: &quot;consumable&quot;,
  &quot;rarity&quot;: &quot;common&quot;,
  &quot;quantity&quot;: 1
}"></textarea>
      </div>
      <button onclick="sendRequest()">å‘é€è¯·æ±‚</button>
    </div>

    <div class="section">
      <h2>å“åº”ç»“æœ</h2>
      <div id="result" class="result" style="display: none;"></div>
    </div>

    <div class="section">
      <h2>è°ƒè¯•ä¿¡æ¯</h2>
      <div id="debug" class="result" style="background: #1a1a2e;"></div>
    </div>
  </div>

  <script>
    // é¢„è®¾æ•°æ®
    const presets = {
      health: {
        itemId: "nd_health_potion_" + Date.now(),
        name: "[New Day] ç”Ÿå‘½è¯æ°´",
        description: "ç«‹å³æ¢å¤ 1000 ç‚¹ç”Ÿå‘½å€¼",
        type: "consumable",
        rarity: "common",
        quantity: 1,
        stats: { healAmount: 1000 },
        originalSource: "allinone_official_store"
      },
      sword: {
        itemId: "nd_iron_sword_" + Date.now(),
        name: "[New Day] é“å‰‘",
        description: "ä¸€æŠŠæ™®é€šçš„é“å‰‘ï¼Œæ”»å‡»åŠ› +15",
        type: "weapon",
        rarity: "common",
        quantity: 1,
        stats: { attack: 15 },
        originalSource: "allinone_official_store"
      },
      armor: {
        itemId: "nd_leather_armor_" + Date.now(),
        name: "[New Day] çš®ç”²",
        description: "è½»å‹æŠ¤ç”²ï¼Œé˜²å¾¡åŠ› +10",
        type: "armor",
        rarity: "uncommon",
        quantity: 1,
        stats: { defense: 10 },
        originalSource: "allinone_official_store"
      },
      minimal: {
        itemId: "nd_test_" + Date.now(),
        name: "æµ‹è¯•é“å…·",
        type: "consumable",
        rarity: "common",
        quantity: 1
      }
    };

    // åŠ è½½é¢„è®¾
    function loadPreset(type) {
      const data = presets[type];
      document.getElementById('requestBody').value = JSON.stringify(data, null, 2);
      logDebug('å·²åŠ è½½é¢„è®¾: ' + type);
    }

    // ä» localStorage è·å– token
    function getTokenFromStorage() {
      try {
        const token = localStorage.getItem('newday_token');
        if (token) {
          document.getElementById('authToken').value = token;
          logDebug('ä» localStorage è·å–åˆ° token: ' + token.substring(0, 30) + '...');
        } else {
          logDebug('localStorage ä¸­æ²¡æœ‰æ‰¾åˆ° newday_token');
          alert('localStorage ä¸­æ²¡æœ‰æ‰¾åˆ° newday_tokenï¼Œè¯·æ‰‹åŠ¨è¾“å…¥');
        }
      } catch (e) {
        logDebug('è·å– token å¤±è´¥: ' + e.message);
      }
    }

    // è®°å½•è°ƒè¯•ä¿¡æ¯
    function logDebug(message) {
      const debugDiv = document.getElementById('debug');
      const time = new Date().toLocaleTimeString();
      debugDiv.innerHTML += `[${time}] ${message}\n`;
      debugDiv.scrollTop = debugDiv.scrollHeight;
    }

    // å‘é€è¯·æ±‚
    async function sendRequest() {
      const apiBase = document.getElementById('apiBase').value.trim();
      const token = document.getElementById('authToken').value.trim();
      const requestBodyStr = document.getElementById('requestBody').value.trim();
      const resultDiv = document.getElementById('result');
      
      if (!apiBase || !token || !requestBodyStr) {
        alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
        return;
      }

      // è§£æè¯·æ±‚ä½“
      let requestBody;
      try {
        requestBody = JSON.parse(requestBodyStr);
      } catch (e) {
        alert('è¯·æ±‚ JSON æ ¼å¼é”™è¯¯: ' + e.message);
        return;
      }

      const url = apiBase + '/allinone/inventory/add';
      
      logDebug('========================================');
      logDebug('å‘é€è¯·æ±‚åˆ°: ' + url);
      logDebug('è¯·æ±‚æ•°æ®: ' + JSON.stringify(requestBody, null, 2));

      resultDiv.style.display = 'block';
      resultDiv.className = 'result';
      resultDiv.textContent = 'å‘é€è¯·æ±‚ä¸­...';

      try {
        const startTime = Date.now();
        
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify(requestBody)
        });

        const duration = Date.now() - startTime;
        const responseText = await response.text();
        
        logDebug('å“åº”çŠ¶æ€: ' + response.status + ' ' + response.statusText);
        logDebug('å“åº”æ—¶é—´: ' + duration + 'ms');
        logDebug('åŸå§‹å“åº”: ' + responseText);

        // æ˜¾ç¤ºç»“æœ
        let resultHtml = `HTTP Status: ${response.status} ${response.statusText}\n`;
        resultHtml += `Response Time: ${duration}ms\n`;
        resultHtml += `\nRaw Response:\n${responseText}\n\n`;

        // å°è¯•è§£æ JSON
        try {
          const jsonData = JSON.parse(responseText);
          resultHtml += `Parsed JSON:\n${JSON.stringify(jsonData, null, 2)}`;
          
          if (response.ok && jsonData.success) {
            resultDiv.classList.add('success');
            logDebug('âœ… è¯·æ±‚æˆåŠŸ');
          } else {
            resultDiv.classList.add('error');
            logDebug('âŒ è¯·æ±‚å¤±è´¥: ' + (jsonData.message || 'æœªçŸ¥é”™è¯¯'));
          }
        } catch (e) {
          resultHtml += `Parse Error: ${e.message}`;
          resultDiv.classList.add('error');
          logDebug('âŒ è§£æå“åº”å¤±è´¥: ' + e.message);
        }

        resultDiv.textContent = resultHtml;
        
      } catch (error) {
        resultDiv.style.display = 'block';
        resultDiv.className = 'result error';
        resultDiv.textContent = `Network Error:\n${error.name}: ${error.message}\n\nStack:\n${error.stack}`;
        logDebug('âŒ ç½‘ç»œé”™è¯¯: ' + error.message);
      }
      
      logDebug('========================================');
    }

    // é¡µé¢åŠ è½½æ—¶åŠ è½½é»˜è®¤é¢„è®¾
    window.onload = function() {
      loadPreset('health');
      logDebug('é¡µé¢åŠ è½½å®Œæˆï¼Œå·²åŠ è½½é»˜è®¤é¢„è®¾');
      
      // å°è¯•è‡ªåŠ¨è·å– token
      setTimeout(getTokenFromStorage, 500);
    };
  </script>
</body>
</html>
